<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ â€” Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>

<style>
:root{
  --green:#28a745;
  --green-dark:#1d7a33;
  --bg:#f6fbf7;
  --card:#ffffff;
  --muted:#6b7280;
  font-family: "Segoe UI", Tahoma, Arial;
}
body{margin:0;background:var(--bg);direction:rtl;padding: 0;} /* Ø¥Ø²Ø§Ù„Ø© padding Ù…Ù† body */

/* PRELOADER STYLES */
#preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    transition: opacity 0.5s ease;
}
#preloader img {
    width: 200px; /* Adjust size as needed */
    height: auto;
    border-radius: 12px;
}
.loader {
    border: 4px solid #f3f3f3;
    border-top: 4px solid var(--green);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin-top: 20px;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* LANDING PAGE STYLES - UPDATED */
#landingPage {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg);
    z-index: 9998;
    display: none;
    display: grid; 
    place-items: center;
    padding: 20px; /* Ù‡ÙˆØ§Ù…Ø´ Ù…ØªØ³Ø§ÙˆÙŠØ© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ */
    box-sizing: border-box;
}

.landing-content {
    background: var(--card);
    padding: 30px 25px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    border-radius: 16px;
    max-width: 400px; /* ØªØµØºÙŠØ± Ø§Ù„Ø¹Ø±Ø¶ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    width: 100%; /* ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ØµØ± ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ§Ø­ */
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    text-align: center;
    margin: auto;
    box-sizing: border-box; /* ØªØ¶Ù…ÙŠÙ† padding ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª */
}

.landing-content h2 {
    color: var(--green-dark);
    margin-bottom: 15px;
    font-size: 1.4rem; /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
}

.landing-form-group {
    margin-bottom: 18px;
    text-align: right;
}

.landing-form-group label {
    display: block;
    margin-bottom: 6px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© ØªØ­Øª label */
    font-weight: 600;
    color: #333;
    font-size: 14px;
}

/* ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¬Ù… ÙˆØ§Ø¨Ø¹Ø§Ø¯ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
.landing-form-group input, .landing-form-group select {
    width: 100%;
    padding: 12px 14px; /* ØªØ¹Ø¯ÙŠÙ„ padding Ù„ÙŠÙƒÙˆÙ† Ù…ØªÙ†Ø§Ø³Ù‚Ø§Ù‹ */
    border-radius: 10px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-family: inherit;
    font-size: 15px;
    direction: rtl;
    text-align: right;
    height: 48px; /* ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù„Ø­Ù‚ÙˆÙ„ */
    transition: border-color 0.3s ease;
}

.landing-form-group input:focus, .landing-form-group select:focus {
    outline: none;
    border-color: var(--green);
    box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.2);
}

.landing-form-group .phone-input{
  direction:ltr;
  text-align:left;
}

/* ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.landing-btn-group {
    display: flex;
    gap: 10px;
    justify-content: space-between;
    margin-top: 15px;
}

.landing-btn-group .btn {
    flex: 1;
    font-size: 15px;
    padding: 12px 8px;
    height: 48px; /* ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
}

.primary-btn {
    background: var(--green);
    color: white;
}

.primary-btn:hover {
    background: var(--green-dark);
}

.secondary-btn {
    background: #f0f0f0;
    color: #333;
    border: 1px solid #ddd;
}

.secondary-btn:hover {
    background: #e0e0e0;
}

/* Ù†Øµ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯ */
#landingPage p {
    color: var(--muted);
    margin-bottom: 25px;
    font-size: 14px;
    line-height: 1.5;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 480px) {
    #landingPage {
        padding: 15px; /* Ù‡ÙˆØ§Ù…Ø´ Ø£ØµØºØ± Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
    }
    
    .landing-content {
        padding: 25px 20px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„ØµØºÙŠØ±Ø© */
        max-width: 100%; /* Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒØ§Ù…Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ§Ø­ */
        margin: 0;
        border-radius: 14px; /* ØªÙ‚Ù„ÙŠÙ„ Ù†ØµÙ Ù‚Ø·Ø± Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    }
    
    .landing-content h2 {
        font-size: 1.3rem;
        margin-bottom: 12px;
    }
    
    .landing-form-group input, .landing-form-group select {
        padding: 10px 12px;
        height: 46px;
        font-size: 14px;
    }
    
    .landing-btn-group .btn {
        height: 46px;
        font-size: 14px;
        padding: 10px 6px;
    }
    
    .landing-form-group {
        margin-bottom: 16px;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© */
@media (max-width: 768px) and (min-width: 481px) {
    .landing-content {
        max-width: 450px;
        padding: 35px 30px;
    }
}

/* HEADER - UPDATED */
header{
  display:flex;
  flex-direction: column;
  padding:14px 20px 0;
  background:linear-gradient(90deg,var(--green-dark),var(--green));
  color:white;
  box-shadow:0 4px 12px rgba(0,0,0,0.12);
  position:sticky;
  top:0;
  z-index:40;
}
.header-top{
  display: flex;
  align-items: center;
  gap: 12px;
  padding-bottom: 14px;
}
.logo{
  width:46px;
  height:46px;
  border-radius:12px;
  background:#ffffff22;
  display:grid;
  place-items:center;
  font-weight:800;
  font-size:20px;
}

/* MAIN */
main{padding:16px;max-width:1100px;margin:auto}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:14px;
}
.card{
  background:var(--card);
  padding:12px;
  border-radius:14px;
  box-shadow:0 5px 14px rgba(0,0,0,0.06);
  transition: transform 0.3s ease;
  position: relative;
}
.card:hover {
  transform: translateY(-5px);
}
.thumb{
  height:120px;
  border-radius:10px;
  background:#e8fbee;
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--green-dark);
  font-size:20px;
  margin-bottom:8px;
  overflow: hidden;
}
.thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.title{
  font-weight:700;
  margin-bottom: 4px;
}
.desc{
  font-size:13px;
  color:var(--muted);
  margin-bottom: 8px;
}
.price{
  font-weight:700;
  color:var(--green-dark);
  font-size: 16px;
}
.btn{
  background:var(--green);
  color:white;
  border:0;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
  margin-top:8px;
  width:100%;
  transition: background 0.3s ease;
}
.btn:hover {
  background:var(--green-dark);
}
.out-of-stock-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 14px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
    pointer-events: none;
    z-index: 5;
}


/* FLOATING CART BUTTON */
.cart-btn{
  position:fixed;
  bottom:20px;
  right:20px;
  background:var(--green);
  color:white;
  padding:14px 18px;
  border-radius:50px;
  box-shadow:0 6px 16px rgba(0,0,0,0.15);
  font-weight:700;
  font-size:15px;
  cursor:pointer;
  z-index:50;
  transition: all 0.3s ease;
}
.cart-btn:hover {
  background:var(--green-dark);
  transform: scale(1.05);
}

/* CART BOTTOM SHEET */
.cart-sheet{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:white;
  overflow:auto;
  z-index:100;
  transition:transform 0.35s ease;
  transform:translateY(100%);
  display:flex;
  flex-direction:column;
}
.cart-sheet.open{
  transform:translateY(0);
}
.cart-header{
  padding:16px;
  background:linear-gradient(90deg,var(--green-dark),var(--green));
  color:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:sticky;
  top:0;
  z-index:10;
}
.cart-body{
  padding:16px;
  flex:1;
  overflow-y:auto;
}
.cart-footer{
  padding:16px;
  background:#f8f9fa;
  border-top:1px solid #dee2e6;
  position:sticky;
  bottom:0;
}
.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 0;
  border-bottom:1px solid #eee;
}
.qty-btn{
  padding:6px 12px;
  border:1px solid #ccc;
  border-radius:8px;
  cursor:pointer;
  margin:0 4px;
  background:#f8f9fa;
  transition: all 0.2s ease;
}
.qty-btn:hover {
  background: #e9ecef;
}

.total-box{
  background:#f2fff4;
  padding:12px;
  border-radius:10px;
  margin:12px 0;
  display:flex;
  justify-content:space-between;
  font-weight:bold;
}

/* ORDER OPTIONS */
.option-box{
  margin-top:10px;
  padding:12px;
  background:#f9fff9;
  border-radius:12px;
  border:1px solid #d9f3dc;
}
.form-group{
  margin-bottom:16px;
}
.form-group label{
  display:block;
  margin-bottom:6px;
  font-weight:600;
}
select,input,textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  box-sizing:border-box;
  font-family:inherit;
  font-size:15px;
}
.phone-input{
  direction:ltr;
  text-align:left;
}

/* NEW STYLES: Combined Search and Select */
.search-and-select-container {
    display: flex;
    gap: 8px;
    margin-bottom: 10px;
}

/* MODIFIED STYLES for the Delivery Area Select in Header */
.delivery-area-select-box {
    width: 45%;
    flex-shrink: 0;
}
.delivery-area-select-box.hidden {
  display: none;
}

.delivery-area-select-box select {
    width: 100%;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #ffffff55;
    background: #ffffff22;
    color: white;
    box-sizing: border-box;
    font-family: inherit;
    font-size: 13px;
    margin: 0;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
    background-repeat: no-repeat;
    background-position: left 10px center;
    padding-left: 30px;
}

.delivery-area-select-box select option {
    background: var(--green-dark);
    color: white;
}

/* MODIFIED STYLES for the Search Box */
.search-box {
    width: 55%;
    flex-grow: 1;
}

.search-box.full-width {
    width: 100%;
}

.search-box input{
  margin-bottom:0;
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
  font-size:14px;
  width: 100%;
  background: white;
  color: #333;
}

/* CATEGORIES STYLES */
.categories-container{
  display:flex;
  gap:8px;
  overflow-x:auto;
  padding-bottom:14px;
  margin-bottom:0;
}
.category-chip{
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
  white-space:nowrap;
  font-weight:600;
  font-size:14px;
  background:#ffffff33;
  color:white;
  border:1px solid #ffffff66;
  transition:0.2s;
}
.category-chip.active, .category-chip:hover{
  background:var(--card);
  color:var(--green-dark);
  border-color:var(--card);
}

/* CLOSE BUTTON */
.close-btn{
  background:none;
  border:none;
  color:white;
  font-size:24px;
  cursor:pointer;
  padding:0;
  width:30px;
  height:30px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* HIDDEN FORM */
.hidden-form {
  display: none;
}

/* SUCCESS MESSAGE */
.success-message {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 200;
  justify-content: center;
  align-items: center;
}
.success-content {
  background: white;
  padding: 30px;
  border-radius: 15px;
  text-align: center;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}
.success-icon {
  font-size: 60px;
  color: var(--green);
  margin-bottom: 20px;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<div id="preloader">
    <img src="https://www2.0zz0.com/2025/12/09/18/567526201.png" alt="Logo">
    <div class="loader"></div>
</div>

<div id="landingPage">
    <div class="landing-content">
        <h2>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ</h2>
        <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ ÙˆØ§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø·Ù„Ø¨.</p>

        <div class="landing-form-group">
            <label for="landingPhoneNumber">Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ</label>
            <input type="tel" id="landingPhoneNumber" class="phone-input" 
                   placeholder="Ù…Ø«Ø§Ù„: 0912345678" 
                   maxlength="10">
        </div>
        
        <div class="landing-form-group">
            <label for="landingAreaSelect">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</label>
            <select id="landingAreaSelect">
                </select>
        </div>
        
        <div class="landing-btn-group">
            <button class="btn primary-btn" id="startOrdering">Ø¨Ø¯Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
            <button class="btn secondary-btn" id="browseMenu">ØªØµÙØ­ Ø§Ù„Ù…Ù†ÙŠÙˆ</button>
        </div>
    </div>
</div>

<header id="mainHeader" style="display: none;">
    <div class="header-top">
      <div style="font-size:17px;font-weight:700">Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ</div>
      <div style="font-size:13px;opacity:.9"></div>
    </div>

    <div class="search-and-select-container">
        <div class="delivery-area-select-box" id="areaSelectBox">
            <select id="headerAreaSelect">
                </select>
        </div>
        
        <div class="search-box" id="searchBoxContainer">
            <input type="text" id="searchBar" placeholder="Ø¨Ø­Ø« ..." onkeyup="filterProducts()">
        </div>
    </div>
    
    <div class="categories-container" id="categoriesContainer">
    </div>
</header>

<main id="mainContent" style="display: none;">
  <div class="grid" id="products"></div>
</main>

<div class="cart-btn" id="cartBtn" style="display: none;">Ø§Ù„Ø³Ù„Ø© (0)</div>

<div class="cart-sheet" id="cartSheet">
  <div class="cart-header">
    <h3 style="margin:0">Ø§Ù„Ø³Ù„Ø©</h3>
    <button class="close-btn" id="closeCartSheet">Ã—</button>
  </div>
  
  <div class="cart-body">
    <div id="cartItems"></div>

    <div class="total-box">
      <div>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</div>
      <div id="subtotal">0.00 Ø¯ÙŠÙ†Ø§Ø±</div>
    </div>
    
    <div class="total-box" id="deliveryPriceBox" style="display:none; background:#f2fff4">
        <div>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</div>
        <div id="deliveryPrice" style="color:var(--green-dark)">0.00 Ø¯ÙŠÙ†Ø§Ø±</div>
    </div>

    <div class="option-box">
      
      <div class="form-group">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨</label>
        <textarea id="orderNotes" rows="3" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø±ÙŠØ¯ Ø§Ù„Ø¨Ø·Ø§Ø·Ø§ Ø¨Ø¯ÙˆÙ† Ù…Ù„Ø­ØŒ Ø£Ùˆ ØªÙˆØµÙŠÙ„ Ù„Ù„Ø¨Ø§Ø¨ Ø±Ù‚Ù… 5"></textarea>
      </div>
      
      <div class="form-group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø·Ù„Ø¨</label>
        <select id="orderType">
          <option value="delivery">ØªÙˆØµÙŠÙ„</option>
          <option value="take">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
        <select id="paymentType">
          </select>
      </div>

      <div class="total-box" style="margin-top:16px">
        <div>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
        <div id="finalTotal">0.00 Ø¯ÙŠÙ†Ø§Ø±</div>
      </div>
    </div>
  </div>
  
  <div class="cart-footer">
    <button class="btn" id="placeOrder" style="font-size:16px;padding:12px">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
  </div>
</div>

<div class="success-message" id="successMessage">
  <div class="success-content">
    <div class="success-icon">âœ“</div>
    <h3 style="color: var(--green-dark); margin-bottom: 10px;">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h3>
    <p style="color: var(--muted); margin-bottom: 20px;">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ Ù…Ù† Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ. Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨.</p>
    <button class="btn" onclick="closeSuccessMessage()" style="width: auto; padding: 10px 30px;">Ù…ÙˆØ§ÙÙ‚</button>
  </div>
</div>

<script>
/* ===== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCA7vLmbwRC-PU_lEMkTiMf3X6pfNm2fbw",
  authDomain: "bordo-ly.firebaseapp.com",
  databaseURL: "https://bordo-ly-default-rtdb.firebaseio.com",
  projectId: "bordo-ly",
  storageBucket: "bordo-ly.firebasestorage.app",
  messagingSenderId: "654879491144",
  appId: "1:654879491144:web:50bd2b026bf6ac9f02c47d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
/* ======================== */

/* GLOBAL CONSTANTS (Ø³ØªØµØ¨Ø­ Ù…ØªØºÙŠØ±Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª) */
const UNIFIED_IMAGE = "https://up6.cc/2025/10/176460585993361.jpg";

/* GLOBAL STATE */
let cart = {};
let allProducts = {};
let allCategories = ["Ø§Ù„ÙƒÙ„"];
let allAreas = {};
let allPaymentMethods = {};
let activeCategory = "Ø§Ù„ÙƒÙ„";
let userArea = "";
let userPhone = "";
let isBrowseMode = false;


// --- FIREBASE DATA LOAD ---
function loadData() {
    // 1. Load Products (ÙˆØ¬Ø¨Ø§Øª)
    db.ref('products').on('value', snapshot => {
        allProducts = snapshot.val() || {};
        const categoriesSet = new Set(Object.values(allProducts).map(p => p.category).filter(c => c));
        allCategories = ["Ø§Ù„ÙƒÙ„", ...categoriesSet];
        renderCategories();
        renderProducts();
    });

    // 2. Load Delivery Areas
    db.ref('deliveryAreas').on('value', snapshot => {
        allAreas = snapshot.val() || {};
        initLandingAreaSelect();
        initHeaderAreaSelect();
    });
    
    // 3. Load Payment Methods
    db.ref('paymentMethods').on('value', snapshot => {
        allPaymentMethods = snapshot.val() || {};
        renderPaymentOptions();
    });
}

// 4. Render Payment Options
function renderPaymentOptions() {
    const paymentSelect = document.getElementById("paymentType");
    paymentSelect.innerHTML = '';

    Object.keys(allPaymentMethods).forEach(methodKey => {
        const method = allPaymentMethods[methodKey];
        const option = document.createElement("option");
        option.value = method.name;
        option.textContent = method.name;
        paymentSelect.appendChild(option);
    });
    
    if (Object.keys(allPaymentMethods).length === 0) {
        const option = document.createElement("option");
        option.value = "ÙƒØ§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…";
        option.textContent = "ÙƒØ§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (Ø§ÙØªØ±Ø§Ø¶ÙŠ)";
        paymentSelect.appendChild(option);
    }
}


// --- PRELOADER & LANDING PAGE LOGIC ---

// 1. Hide Preloader after page load
window.onload = function() {
    loadData();
    
    const savedPhone = localStorage.getItem('userPhone');
    const savedArea = localStorage.getItem('userArea');
    if (savedPhone) {
        document.getElementById('landingPhoneNumber').value = savedPhone;
    }
    if (savedArea) {
        userArea = savedArea; 
    }
    
    document.getElementById('preloader').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('preloader').style.display = 'none';
        document.getElementById('landingPage').style.display = 'grid';
        
        history.pushState({ page: 'landing' }, 'Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ - Ø¨Ø¯Ø¡ Ø§Ù„Ø·Ù„Ø¨');
    }, 500);
};

// 2. Populate Landing Area Select from Firebase data
function initLandingAreaSelect() {
    const landingAreaSelect = document.getElementById("landingAreaSelect");
    const currentSelectedArea = userArea || landingAreaSelect.value; 
    landingAreaSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</option>';
    
    Object.keys(allAreas).forEach(areaKey => {
        const area = allAreas[areaKey];
        const option = document.createElement("option");
        option.value = area.name;
        option.textContent = area.name;
        landingAreaSelect.appendChild(option);
    });
    
    if (currentSelectedArea) {
        landingAreaSelect.value = currentSelectedArea;
    }
}


// 3. Handle Landing Page interaction (Start Ordering)
document.getElementById("startOrdering").onclick = function() {
    const landingAreaSelect = document.getElementById("landingAreaSelect");
    const landingPhoneNumberInput = document.getElementById("landingPhoneNumber");
    
    const area = landingAreaSelect.value;
    const phone = landingPhoneNumberInput.value.trim();

    if (!area) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„.");
        landingAreaSelect.focus();
        return;
    }
    if (!phone || phone.length < 10) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­ Ù…ÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù….");
        landingPhoneNumberInput.focus();
        return;
    }

    userArea = area;
    userPhone = phone;
    isBrowseMode = false;
    
    localStorage.setItem('userPhone', userPhone);
    localStorage.setItem('userArea', userArea);

    enterMainApp(false); 
};

// 4. Handle Landing Page interaction (Browse Menu)
document.getElementById("browseMenu").onclick = function() {
    userArea = ""; 
    userPhone = "";
    isBrowseMode = true;

    enterMainApp(true); 
};

// 5. Function to transition to the main app interface
function enterMainApp(browseMode = false) {
    document.getElementById('landingPage').style.display = 'none';
    document.getElementById('mainHeader').style.display = 'flex';
    document.getElementById('mainContent').style.display = 'block';

    const areaSelectBox = document.getElementById('areaSelectBox');
    const searchBoxContainer = document.getElementById('searchBoxContainer');
    
    if (browseMode) {
        areaSelectBox.classList.add('hidden');
        searchBoxContainer.classList.add('full-width');
        document.getElementById('cartBtn').style.display = 'none';

        history.pushState({ page: 'browse' }, 'Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ - ØªØµÙØ­ Ø§Ù„Ù…Ù†ÙŠÙˆ');

    } else {
        areaSelectBox.classList.remove('hidden');
        searchBoxContainer.classList.remove('full-width');
        document.getElementById('cartBtn').style.display = 'block';

        history.pushState({ page: 'order' }, 'Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ - Ø§Ù„Ø·Ù„Ø¨');
    }

    initHeaderAreaSelect();
    renderProducts();
    renderCategories();
    renderCart();
    renderPaymentOptions();
}

// *** Ø¥Ø¶Ø§ÙØ©: Ù…Ù†Ø·Ù‚ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ (Back Button) ***
window.onpopstate = function(event) {
    if (event.state && event.state.page === 'landing') {
        document.getElementById('mainHeader').style.display = 'none';
        document.getElementById('mainContent').style.display = 'none';
        document.getElementById('cartBtn').style.display = 'none';
        document.getElementById('landingPage').style.display = 'grid';
        isBrowseMode = false;
    } else if (event.state && (event.state.page === 'browse' || event.state.page === 'order')) {
        document.getElementById('landingPage').style.display = 'none';
        document.getElementById('mainHeader').style.display = 'flex';
        document.getElementById('mainContent').style.display = 'block';
        if(event.state.page === 'order') {
             document.getElementById('cartBtn').style.display = 'block';
             document.getElementById('areaSelectBox').classList.remove('hidden');
             document.getElementById('searchBoxContainer').classList.remove('full-width');
        } else {
             document.getElementById('cartBtn').style.display = 'none';
             document.getElementById('areaSelectBox').classList.add('hidden');
             document.getElementById('searchBoxContainer').classList.add('full-width');
        }
    } else {
        console.log('Unhandled history state or initial load.');
    }
};


// --- HEADER AREA SELECT LOGIC ---

function initHeaderAreaSelect() {
    const headerAreaSelect = document.getElementById("headerAreaSelect");
    headerAreaSelect.innerHTML = "";

    const defaultOption = document.createElement("option");
    defaultOption.value = "";
    defaultOption.textContent = "Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©";
    headerAreaSelect.appendChild(defaultOption);

    Object.values(allAreas).forEach(area => {
        const option = document.createElement("option");
        option.value = area.name;
        option.textContent = area.name;
        headerAreaSelect.appendChild(option);
    });

    if (userArea) {
        headerAreaSelect.value = userArea;
    }
    
    headerAreaSelect.onchange = updateTotal;
}

// --- PRODUCT & CATEGORY LOGIC ---

function renderProducts(searchQuery = ""){
  const box = document.getElementById("products");
  box.innerHTML = "";
  const query = searchQuery.toLowerCase();

  const productsArray = Object.values(allProducts).filter(p => p && p.name && p.category && p.price);

  const filteredProducts = productsArray.filter(p => {
    const matchesSearch = p.name.toLowerCase().includes(query) || (p.desc || '').toLowerCase().includes(query);
    const matchesCategory = activeCategory === "Ø§Ù„ÙƒÙ„" || p.category === activeCategory;

    return matchesSearch && matchesCategory;
  });

  if(filteredProducts.length === 0){
    box.innerHTML = '<p style="text-align:center;color:var(--muted);padding:20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø­Ø¯Ø¯.</p>';
    return;
  }

  filteredProducts.forEach(p=>{
    const isOutOfStock = p.outOfStock;
    box.innerHTML += `
      <div class="card" ${isOutOfStock ? 'style="opacity:0.6; pointer-events:none;"' : ''}>
        <div class="thumb">
          <img src="${p.image || UNIFIED_IMAGE}" alt="${p.name}" loading="lazy">
        </div>
        <div class="title">${p.name}</div>
        <div class="desc">${p.desc || ''}</div>
        <div class="price">${p.price}.00 Ø¯ÙŠÙ†Ø§Ø±</div>
        <button class="btn" onclick="addToCart('${p.id}')" ${isOutOfStock ? 'disabled' : ''}>${isBrowseMode ? 'Ø§Ø¶ØºØ· Ù„Ù„Ø·Ù„Ø¨' : 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©'}</button>
        ${isOutOfStock ? '<div class="out-of-stock-overlay">Ù†ÙØ¯Øª Ø§Ù„ÙƒÙ…ÙŠØ©</div>' : ''}
      </div>
    `;
  });
}

function filterProducts(){
  const searchQuery = document.getElementById("searchBar").value;
  renderProducts(searchQuery);
}

function renderCategories(){
  const container = document.getElementById("categoriesContainer");
  container.innerHTML = "";

  allCategories.forEach(cat => {
    const isActive = cat === activeCategory ? "active" : "";
    container.innerHTML += `
      <div class="category-chip ${isActive}" onclick="setCategory('${cat}')">
        ${cat}
      </div>
    `;
  });
}

function setCategory(category){
  activeCategory = category;
  renderCategories();
  filterProducts();
}


// --- CART LOGIC ---

function addToCart(id){
  if (isBrowseMode) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ ÙˆÙ…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø·Ù„Ø¨.");
    history.back(); 
    return;
  }

  const p = allProducts[id];
  if(!p || p.outOfStock) return;

  if(!cart[id]) cart[id] = {...p, qty:0};
  cart[id].qty++;
  renderCart();
}

function changeQty(id,amount){
  if(!cart[id]) return;
  cart[id].qty += amount;
  if(cart[id].qty<=0) delete cart[id];
  renderCart();
}

function renderCart(){
  const items = document.getElementById("cartItems");
  items.innerHTML = "";

  let subtotal = 0;

  if(Object.keys(cart).length === 0){
    items.innerHTML = `
      <div style="text-align:center;padding:40px 20px;color:var(--muted)">
        <div style="font-size:24px;margin-bottom:10px">ğŸ›’</div>
        <div style="font-size:16px">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>
        <div style="font-size:14px;margin-top:8px">Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
      </div>
    `;
  } else {
    Object.values(cart).forEach(it=>{
      subtotal += it.price * it.qty;
      items.innerHTML += `
        <div class="cart-item">
          <div style="flex:1">
            <strong>${it.name}</strong><br>
            <span style="font-size:14px;color:var(--muted)">${it.price}.00 Ø¯ÙŠÙ†Ø§Ø± Ã— ${it.qty}</span>
          </div>
          <div>
            <button class="qty-btn" onclick="changeQty('${it.id}',1)">+</button>
            <span style="padding:0 8px;font-weight:bold">${it.qty}</span>
            <button class="qty-btn" onclick="changeQty('${it.id}',-1)">-</button>
          </div>
        </div>
      `;
    });
  }

  document.getElementById("subtotal").textContent = subtotal.toFixed(2) + " Ø¯ÙŠÙ†Ø§Ø±";
  updateTotal();

  const count = Object.values(cart).reduce((s,i)=>s+i.qty,0);
  document.getElementById("cartBtn").textContent = `Ø§Ù„Ø³Ù„Ø© (${count})`;
}

/* CART SHEET TOGGLE */
document.getElementById("cartBtn").onclick = ()=>{
  document.getElementById("cartSheet").classList.add("open");
};

document.getElementById("closeCartSheet").onclick = ()=>{
  document.getElementById("cartSheet").classList.remove("open");
};

document.getElementById("cartSheet").addEventListener('click', function(e) {
  if(e.target.id === 'cartSheet') {
    this.classList.remove('open');
  }
});

/* ORDER TYPE + DELIVERY */
document.getElementById("orderType").onchange = updateTotal;
document.getElementById("paymentType").onchange = updateTotal;

/* FINAL TOTAL */
function updateTotal(){
  let subtotal = 0;
  Object.values(cart).forEach(i=> subtotal += i.price * i.qty);
  
  function getDeliveryPrice(areaName) {
      const area = Object.values(allAreas).find(a => a.name === areaName);
      return area ? area.price : 0;
  }

  const type = document.getElementById("orderType").value;
  const area = document.getElementById("headerAreaSelect").value; 
  let delivery = 0;

  if(type==="delivery" && area){
    delivery = getDeliveryPrice(area) || 0;
    document.getElementById("deliveryPriceBox").style.display = 'flex';
    document.getElementById("deliveryPrice").textContent = delivery.toFixed(2) + " Ø¯ÙŠÙ†Ø§Ø±";
  } else {
    document.getElementById("deliveryPriceBox").style.display = 'none';
  }

  document.getElementById("subtotal").textContent = subtotal.toFixed(2) + " Ø¯ÙŠÙ†Ø§Ø±";
  
  document.getElementById("finalTotal").textContent =
    (subtotal + delivery).toFixed(2) + " Ø¯ÙŠÙ†Ø§Ø±";
}


/* SUCCESS MESSAGE FUNCTIONS */
function showSuccessMessage() {
  document.getElementById("successMessage").style.display = "flex";
}

function closeSuccessMessage() {
  document.getElementById("successMessage").style.display = "none";
}

/* PLACE ORDER - Send to Firebase */
document.getElementById("placeOrder").onclick = ()=>{
  if(Object.keys(cart).length===0){
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
    return;
  }
  
  const orderNotes = document.getElementById("orderNotes").value.trim();
  const orderType = document.getElementById("orderType").value;
  const paymentType = document.getElementById("paymentType").value;
  
  const area = document.getElementById("headerAreaSelect").value;
  
  if(orderType === "delivery" && !area) {
     alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© (Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©) Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„.");
     document.getElementById("headerAreaSelect").focus();
     return;
  }
  
  let subtotal = 0;
  const cartItems = Object.values(cart).map(i => {
    subtotal += i.price * i.qty;
    return {
        id: i.id,
        name: i.name,
        price: i.price,
        qty: i.qty,
        total: i.price * i.qty
    };
  });
  
  function getDeliveryPrice(areaName) {
      const area = Object.values(allAreas).find(a => a.name === areaName);
      return area ? area.price : 0;
  }

  let delivery = 0;
  if(orderType === "delivery" && area) {
    delivery = getDeliveryPrice(area) || 0;
  }
  const finalTotal = subtotal + delivery;
  
  const orderData = {
    customerPhone: userPhone,
    customerArea: area || "Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…",
    method: orderType,
    payment: paymentType,
    total: finalTotal,
    subtotal: subtotal,
    deliveryFee: delivery,
    notes: orderNotes || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª",
    items: cartItems,
    createdAt: Date.now(),
    status: 'received'
  };
  
  db.ref('orders').push(orderData)
    .then(() => {
        showSuccessMessage();
        
        cart = {};
        renderCart();
        document.getElementById("orderNotes").value = "";
        document.getElementById("orderType").value = "delivery";
        document.getElementById("cartSheet").classList.remove("open");
    })
    .catch(error => {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: " + error.message);
    });
};
</script>
</body>
</html>