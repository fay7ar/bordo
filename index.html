<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ â€” Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>

<style>
:root{
  --green:#28a745;
  --green-dark:#1d7a33;
  --bg:#f6fbf7;
  --card:#ffffff;
  --muted:#6b7280;
  font-family: "Segoe UI", Tahoma, Arial;
}
body{margin:0;background:var(--bg);direction:rtl}

/* PRELOADER STYLES */
#preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: white;
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    transition: opacity 0.5s ease;
}
#preloader img {
    width: 200px; /* Adjust size as needed */
    height: auto;
    border-radius: 12px;
}
.loader {
    border: 4px solid #f3f3f3;
    border-top: 4px solid var(--green);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin-top: 20px;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* LANDING PAGE STYLES - MODIFIED FOR PERFECT CENTERING */
#landingPage {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg);
    z-index: 9998;
    display: none; /* Controlled by JS */
    /* Ensure content is centered */
    justify-content: center;
    align-items: center;
    padding: 20px;
}
.landing-content {
    background: var(--card);
    padding: 30px;
    border-radius: 15px;
    max-width: 400px; /* Adjusted for better centering on smaller screens */
    width: 100%;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    text-align: center;
}
.landing-content h2 {
    color: var(--green-dark);
    margin-bottom: 20px;
}
.landing-form-group {
    margin-bottom: 20px;
    text-align: right;
}
.landing-form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}
.landing-form-group input, .landing-form-group select {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-family: inherit;
    font-size: 15px;
    direction: rtl;
    text-align: right;
}
.landing-form-group .phone-input{
  direction:ltr;
  text-align:left;
}

/* Button group style */
.landing-btn-group {
    display: flex;
    gap: 10px;
    justify-content: space-between;
    margin-top: 10px;
}
.landing-btn-group .btn {
    flex: 1;
    font-size: 15px;
    padding: 12px 10px;
}
.secondary-btn {
    background: #ccc;
    color: #333;
}
.secondary-btn:hover {
    background: #bbb;
}


/* HEADER */
header{
  /* The header is now a column container */
  display:none; /* Controlled by JS */
  flex-direction: column; /* Stack items vertically */
  padding:14px 20px 0; /* Adjusted padding */
  background:linear-gradient(90deg,var(--green-dark),var(--green));
  color:white;
  box-shadow:0 4px 12px rgba(0,0,0,0.12);
  position:sticky;
  top:0;
  z-index:40;
}
.header-top{
  display: flex;
  align-items: center;
  gap: 12px;
  padding-bottom: 14px; /* Space above search/select */
}
.logo{
  width:46px;
  height:46px;
  border-radius:12px;
  background:#ffffff22;
  display:grid;
  place-items:center;
  font-weight:800;
  font-size:20px;
}

/* MAIN */
main{padding:16px;max-width:1100px;margin:auto; display: none;} /* Controlled by JS */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:14px;
}
.card{
  background:var(--card);
  padding:12px;
  border-radius:14px;
  box-shadow:0 5px 14px rgba(0,0,0,0.06);
  transition: transform 0.3s ease;
  position: relative; 
}
.card:hover {
  transform: translateY(-5px);
}
.thumb{
  height:120px;
  border-radius:10px;
  background:#e8fbee;
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--green-dark);
  font-size:20px;
  margin-bottom:8px;
  overflow: hidden;
}
.thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.title{
  font-weight:700;
  margin-bottom: 4px;
}
.desc{
  font-size:13px;
  color:var(--muted);
  margin-bottom: 8px;
}
.price{
  font-weight:700;
  color:var(--green-dark);
  font-size: 16px;
}
.btn{
  background:var(--green);
  color:white;
  border:0;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
  margin-top:8px;
  width:100%;
  transition: background 0.3s ease;
}
.btn:hover {
  background:var(--green-dark);
}
.out-of-stock-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 14px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
    pointer-events: none; 
    z-index: 5;
}


/* FLOATING CART BUTTON */
.cart-btn{
  position:fixed;
  bottom:20px;
  right:20px;
  background:var(--green);
  color:white;
  padding:14px 18px;
  border-radius:50px;
  box-shadow:0 6px 16px rgba(0,0,0,0.15);
  font-weight:700;
  font-size:15px;
  cursor:pointer;
  z-index:50;
  transition: all 0.3s ease;
  display: none; /* Controlled by JS */
}
.cart-btn:hover {
  background:var(--green-dark);
  transform: scale(1.05);
}

/* CART BOTTOM SHEET */
.cart-sheet{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:white;
  overflow:auto;
  z-index:100;
  transition:transform 0.35s ease;
  transform:translateY(100%);
  display:flex;
  flex-direction:column;
}
.cart-sheet.open{
  transform:translateY(0);
}
.cart-header{
  padding:16px;
  background:linear-gradient(90deg,var(--green-dark),var(--green));
  color:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:sticky;
  top:0;
  z-index:10;
}
.cart-body{
  padding:16px;
  flex:1;
  overflow-y:auto;
}
.cart-footer{
  padding:16px;
  background:#f8f9fa;
  border-top:1px solid #dee2e6;
  position:sticky;
  bottom:0;
}
.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 0;
  border-bottom:1px solid #eee;
}
.qty-btn{
  padding:6px 12px;
  border:1px solid #ccc;
  border-radius:8px;
  cursor:pointer;
  margin:0 4px;
  background:#f8f9fa;
  transition: all 0.2s ease;
}
.qty-btn:hover {
  background: #e9ecef;
}

.total-box{
  background:#f2fff4;
  padding:12px;
  border-radius:10px;
  margin:12px 0;
  display:flex;
  justify-content:space-between;
  font-weight:bold;
}

/* ORDER OPTIONS */
.option-box{
  margin-top:10px;
  padding:12px;
  background:#f9fff9;
  border-radius:12px;
  border:1px solid #d9f3dc;
}
.form-group{
  margin-bottom:16px;
}
.form-group label{
  display:block;
  margin-bottom:6px;
  font-weight:600;
}
select,input,textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #ccc;
  box-sizing:border-box;
  font-family:inherit;
  font-size:15px;
}
.phone-input{
  direction:ltr;
  text-align:left;
}

/* Combined Search and Select */
.search-and-select-container {
    display: flex;
    gap: 8px; 
    margin-bottom: 10px; 
}

/* Delivery Area Select in Header */
.delivery-area-select-box {
    width: 45%; 
    flex-shrink: 0;
}
/* Style change for hidden area */
.delivery-area-select-box.hidden {
  display: none;
}


.delivery-area-select-box select {
    width: 100%;
    padding: 8px 10px; 
    border-radius: 10px;
    border: 1px solid #ffffff55; 
    background: #ffffff22; 
    color: white; 
    box-sizing: border-box;
    font-family: inherit;
    font-size: 13px; 
    margin: 0; 
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="%23ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
    background-repeat: no-repeat;
    background-position: left 10px center;
    padding-left: 30px; 
}
.delivery-area-select-box select option {
    background: var(--green-dark); 
    color: white;
}


/* Search Box */
.search-box {
    width: 55%; 
    flex-grow: 1;
}

.search-box.full-width {
    width: 100%; 
}

.search-box input{
  margin-bottom:0; 
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
  font-size:14px;
  width: 100%;
  background: white;
  color: #333;
}


/* CATEGORIES STYLES */
.categories-container{
  display:flex;
  gap:8px;
  overflow-x:auto;
  padding-bottom:14px;
  margin-bottom:0;
}
.category-chip{
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
  white-space:nowrap;
  font-weight:600;
  font-size:14px;
  background:#ffffff33;
  color:white;
  border:1px solid #ffffff66;
  transition:0.2s;
}
.category-chip.active, .category-chip:hover{
  background:var(--card);
  color:var(--green-dark);
  border-color:var(--card);
}

/* CLOSE BUTTON */
.close-btn{
  background:none;
  border:none;
  color:white;
  font-size:24px;
  cursor:pointer;
  padding:0;
  width:30px;
  height:30px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* SUCCESS MESSAGE */
.success-message {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 200;
  justify-content: center;
  align-items: center;
}
.success-content {
  background: white;
  padding: 30px;
  border-radius: 15px;
  text-align: center;
  max-width: 400px;
  width: 90%;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}
.success-icon {
  font-size: 60px;
  color: var(--green);
  margin-bottom: 20px;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<div id="preloader">
    <img src="https://www2.0zz0.com/2025/12/09/18/567526201.png" alt="Logo">
    <div class="loader"></div>
</div>

<div id="landingPage">
    <div class="landing-content">
        <h2>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ</h2>
        <p style="color:var(--muted); margin-bottom: 25px;">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ ÙˆØ§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø·Ù„Ø¨.</p>

        <div class="landing-form-group">
            <label for="landingPhoneNumber">Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ</label>
            <input type="tel" id="landingPhoneNumber" class="phone-input" 
                   placeholder="Ù…Ø«Ø§Ù„: 0912345678" 
                   maxlength="10">
        </div>
        
        <div class="landing-form-group">
            <label for="landingAreaSelect">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</label>
            <select id="landingAreaSelect">
                </select>
        </div>
        
        <div class="landing-btn-group">
            <button class="btn" id="startOrdering">Ø¨Ø¯Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
            <button class="btn secondary-btn" id="browseMenu">ØªØµÙØ­ Ø§Ù„Ù…Ù†ÙŠÙˆ</button>
        </div>
    </div>
</div>

<header id="mainHeader">
    <div class="header-top">
      <div style="font-size:17px;font-weight:700">Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ</div>
      <div style="font-size:13px;opacity:.9"></div>
    </div>

    <div class="search-and-select-container">
        <div class="delivery-area-select-box" id="areaSelectBox">
            <select id="headerAreaSelect">
                </select>
        </div>
        
        <div class="search-box" id="searchBoxContainer">
            <input type="text" id="searchBar" placeholder="Ø¨Ø­Ø« ..." onkeyup="filterProducts()">
        </div>
    </div>
    
    <div class="categories-container" id="categoriesContainer">
    </div>
</header>

<main id="mainContent">
  <div class="grid" id="products"></div>
</main>

<div class="cart-btn" id="cartBtn">Ø§Ù„Ø³Ù„Ø© (0)</div>

<div class="cart-sheet" id="cartSheet">
  <div class="cart-header">
    <h3 style="margin:0">Ø§Ù„Ø³Ù„Ø©</h3>
    <button class="close-btn" id="closeCartSheet">Ã—</button>
  </div>
  
  <div class="cart-body">
    <div id="cartItems"></div>

    <div class="total-box">
      <div>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</div>
      <div id="subtotal">0.00 Ø¯ÙŠÙ†Ø§Ø±</div>
    </div>
    
    <div class="total-box" id="deliveryPriceBox" style="display:none; background:#f2fff4">
        <div>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</div>
        <div id="deliveryPrice" style="color:var(--green-dark)">0.00 Ø¯ÙŠÙ†Ø§Ø±</div>
    </div>

    <div class="option-box">
      
      <div class="form-group">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨</label>
        <textarea id="orderNotes" rows="3" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø±ÙŠØ¯ Ø§Ù„Ø¨Ø·Ø§Ø·Ø§ Ø¨Ø¯ÙˆÙ† Ù…Ù„Ø­ØŒ Ø£Ùˆ ØªÙˆØµÙŠÙ„ Ù„Ù„Ø¨Ø§Ø¨ Ø±Ù‚Ù… 5"></textarea>
      </div>
      
      <div class="form-group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø·Ù„Ø¨</label>
        <select id="orderType">
          <option value="delivery">ØªÙˆØµÙŠÙ„</option>
          <option value="take">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
        <select id="paymentType">
          <option value="cash">ÙƒØ§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
          <option value="mobi">Ù…ÙˆØ¨ÙŠ ÙƒØ§Ø´</option>
        </select>
      </div>

      <div class="total-box" style="margin-top:16px">
        <div>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
        <div id="finalTotal">0.00 Ø¯ÙŠÙ†Ø§Ø±</div>
      </div>
    </div>
  </div>
  
  <div class="cart-footer">
    <button class="btn" id="placeOrder" style="font-size:16px;padding:12px">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
  </div>
</div>

<div class="success-message" id="successMessage">
  <div class="success-content">
    <div class="success-icon">âœ“</div>
    <h3 style="color: var(--green-dark); margin-bottom: 10px;">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h3>
    <p style="color: var(--muted); margin-bottom: 20px;">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ Ù…Ù† Ø¯Ø¬Ø§Ø¬ Ø¨ÙˆØ±Ø¯Ùˆ. Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨.</p>
    <button class="btn" onclick="closeSuccessMessage()" style="width: auto; padding: 10px 30px;">Ù…ÙˆØ§ÙÙ‚</button>
  </div>
</div>

<script>
/* ===== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ===== */
const firebaseConfig = {
  apiKey: "AIzaSyCA7vLmbwRC-PU_lEMkTiMf3X6pfNm2fbw",
  authDomain: "bordo-ly.firebaseapp.com",
  databaseURL: "https://bordo-ly-default-rtdb.firebaseio.com",
  projectId: "bordo-ly",
  storageBucket: "bordo-ly.firebasestorage.app",
  messagingSenderId: "654879491144",
  appId: "1:654879491144:web:50bd2b026bf6ac9f02c47d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
/* ======================== */

/* GLOBAL CONSTANTS */
const UNIFIED_IMAGE = "https://up6.cc/2025/10/176460585993361.jpg";

/* GLOBAL STATE */
let cart = {};
let allProducts = {}; 
let allCategories = ["Ø§Ù„ÙƒÙ„"]; 
let allAreas = {}; 
let activeCategory = "Ø§Ù„ÙƒÙ„";
let userArea = ""; 
let userPhone = ""; 
let isBrowseMode = false; 

// --- FIREBASE DATA LOAD ---
function loadData() {
    // 1. Load Products (ÙˆØ¬Ø¨Ø§Øª)
    db.ref('products').on('value', snapshot => {
        allProducts = snapshot.val() || {};
        const categoriesSet = new Set(Object.values(allProducts).map(p => p.category).filter(c => c));
        allCategories = ["Ø§Ù„ÙƒÙ„", ...categoriesSet];
        // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø£Ø¹Ø¯ ØªØµÙŠÙŠØ± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†ÙŠÙˆ
        if (document.getElementById('mainHeader').style.display !== 'none') {
            renderCategories();
            renderProducts();
        }
    });

    // 2. Load Delivery Areas
    db.ref('deliveryAreas').on('value', snapshot => {
        allAreas = snapshot.val() || {};
        // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ØŒ Ø£Ø¹Ø¯ ØªÙ‡ÙŠØ¦Ø© Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        initLandingAreaSelect(); 
        initHeaderAreaSelect(); 
    });
}

// --- VIEW MANAGEMENT & HISTORY API (Ø¬Ø¯ÙŠØ¯/Ù…ÙØ¹Ø¯Ù‘Ù„) ---

/**
 * Ø¯Ø§Ù„Ø© Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª (ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ· Ø£Ùˆ Ø§Ù„Ù…Ù†ÙŠÙˆ).
 * ØªØ³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® (History State).
 */
function showPage(pageName, browseMode = false) {
    // 1. Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    document.getElementById('landingPage').style.display = 'none';
    document.getElementById('mainHeader').style.display = 'none';
    document.getElementById('mainContent').style.display = 'none';
    document.getElementById('cartBtn').style.display = 'none';

    if (pageName === 'landing') {
        document.getElementById('landingPage').style.display = 'flex';
    } else if (pageName === 'main') {
        document.getElementById('mainHeader').style.display = 'flex';
        document.getElementById('mainContent').style.display = 'block';
        
        const areaSelectBox = document.getElementById('areaSelectBox');
        const searchBoxContainer = document.getElementById('searchBoxContainer');
        
        // 2. ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¶Ø¹ Ø§Ù„ØªØµÙØ­ Ø£Ùˆ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„
        if (browseMode) {
            areaSelectBox.classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
            searchBoxContainer.classList.add('full-width'); // Ø¬Ø¹Ù„ Ø§Ù„Ø¨Ø­Ø« Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„
        } else {
            areaSelectBox.classList.remove('hidden'); // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
            searchBoxContainer.classList.remove('full-width'); // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø­Ø«
            document.getElementById('cartBtn').style.display = 'block'; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø³Ù„Ø©
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØµÙŠÙŠØ± Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·
        initHeaderAreaSelect();
        renderProducts();
        renderCategories();
        renderCart();
    }
}


// 1. Initial Load & History Setup
window.onload = function() {
    loadData(); // Ø§Ø¨Ø¯Ø£ Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
    
    // **Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯:** ØªÙ‡ÙŠØ¦Ø© Ø­Ø§Ù„Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£ÙˆÙ„ÙŠØ©.
    // ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ø­ÙØ¸ 'landing' ÙƒØ­Ø§Ù„Ø© Ø£ÙˆÙ„Ù‰
    history.replaceState({ page: 'landing' }, '', location.pathname); 

    document.getElementById('preloader').style.opacity = '0';
    setTimeout(() => {
        document.getElementById('preloader').style.display = 'none';
        showPage('landing'); // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·
    }, 500);
};

// **Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯:** Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø­Ø¯Ø« Ø§Ù„Ø±Ø¬ÙˆØ¹ ÙÙŠ Ø§Ù„Ù‡Ø§ØªÙ
window.addEventListener('popstate', (event) => {
    const state = event.state;
    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØªØµÙØ­ Ù‡ÙŠ 'main'ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ÙŠÙˆ
    if (state && state.page === 'main') {
        showPage('main', state.browse);
    } else {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­Ø§Ù„Ø© ÙØ§Ø±ØºØ© Ø£Ùˆ ØºÙŠØ± 'main' (Ø£ÙŠ 'landing')ØŒ Ø§Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ·
        showPage('landing');
    }
});


// 2. Populate Landing Area Select from Firebase data
function initLandingAreaSelect() {
    const landingAreaSelect = document.getElementById("landingAreaSelect");
    landingAreaSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</option>';
    
    Object.keys(allAreas).forEach(areaKey => {
        const area = allAreas[areaKey];
        const option = document.createElement("option");
        option.value = area.name;
        option.textContent = `${area.name} (${area.price.toFixed(2)} Ø¯ÙŠÙ†Ø§Ø±)`;
        landingAreaSelect.appendChild(option);
    });
}


// 3. Handle Landing Page interaction (Start Ordering) - MODIFIED
document.getElementById("startOrdering").onclick = function() {
    const landingAreaSelect = document.getElementById("landingAreaSelect");
    const landingPhoneNumberInput = document.getElementById("landingPhoneNumber");
    
    const area = landingAreaSelect.value;
    const phone = landingPhoneNumberInput.value.trim();

    if (!area) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„.");
        landingAreaSelect.focus();
        return;
    }
    if (!phone || phone.length < 10) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­ Ù…ÙƒÙˆÙ† Ù…Ù† 10 Ø£Ø±Ù‚Ø§Ù….");
        landingPhoneNumberInput.focus();
        return;
    }

    userArea = area;
    userPhone = phone;
    isBrowseMode = false;

    enterMainApp(false); 
};

// 4. Handle Landing Page interaction (Browse Menu) - MODIFIED
document.getElementById("browseMenu").onclick = function() {
    userArea = ""; 
    userPhone = "";
    isBrowseMode = true; 

    enterMainApp(true); 
};

// 5. Function to transition to the main app interface (MODIFIED)
function enterMainApp(browseMode = false) {
    // **Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯:** Ø¯ÙØ¹ Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†ÙŠÙˆ
    history.pushState({ page: 'main', browse: browseMode }, '', '#menu');

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© showPage
    showPage('main', browseMode);
}

// --- HEADER AREA SELECT LOGIC ---

function initHeaderAreaSelect() {
    const headerAreaSelect = document.getElementById("headerAreaSelect");
    headerAreaSelect.innerHTML = ""; 

    const defaultOption = document.createElement("option");
    defaultOption.value = "";
    defaultOption.textContent = "Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©";
    headerAreaSelect.appendChild(defaultOption);

    Object.values(allAreas).forEach(area => {
        const option = document.createElement("option");
        option.value = area.name;
        option.textContent = area.name;
        headerAreaSelect.appendChild(option);
    });

    if (userArea) {
        headerAreaSelect.value = userArea;
    }
    
    headerAreaSelect.onchange = updateTotal;
}

// --- PRODUCT & CATEGORY LOGIC (ÙƒÙ…Ø§ Ù‡Ùˆ) ---

function renderProducts(searchQuery = ""){
  const box = document.getElementById("products");
  box.innerHTML = "";
  const query = searchQuery.toLowerCase();

  const productsArray = Object.values(allProducts).filter(p => p && p.name && p.category && p.price);

  const filteredProducts = productsArray.filter(p => {
    const matchesSearch = p.name.toLowerCase().includes(query) || (p.desc || '').toLowerCase().includes(query);
    const matchesCategory = activeCategory === "Ø§Ù„ÙƒÙ„" || p.category === activeCategory;
    return matchesSearch && matchesCategory;
  });

  if(filteredProducts.length === 0){
    box.innerHTML = '<p style="text-align:center;color:var(--muted);padding:20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø­Ø¯Ø¯.</p>';
    return;
  }

  filteredProducts.forEach(p=>{
    const isOutOfStock = p.outOfStock;
    box.innerHTML += `
      <div class="card" ${isOutOfStock ? 'style="opacity:0.6; pointer-events:none;"' : ''}>
        <div class="thumb">
          <img src="${p.image || UNIFIED_IMAGE}" alt="${p.name}" loading="lazy">
        </div>
        <div class="title">${p.name}</div>
        <div class="desc">${p.desc || ''}</div>
        <div class="price">${p.price}.00 Ø¯ÙŠÙ†Ø§Ø±</div>
        <button class="btn" onclick="addToCart('${p.id}')" ${isOutOfStock ? 'disabled' : ''}>${isBrowseMode ? 'Ø§Ø¶ØºØ· Ù„Ù„Ø·Ù„Ø¨' : 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©'}</button>
        ${isOutOfStock ? '<div class="out-of-stock-overlay">Ù†ÙØ¯Øª Ø§Ù„ÙƒÙ…ÙŠØ©</div>' : ''}
      </div>
    `;
  });
}

function filterProducts(){
  const searchQuery = document.getElementById("searchBar").value;
  renderProducts(searchQuery);
}

function renderCategories(){
  const container = document.getElementById("categoriesContainer");
  container.innerHTML = "";

  allCategories.forEach(cat => {
    const isActive = cat === activeCategory ? "active" : "";
    container.innerHTML += `
      <div class="category-chip ${isActive}" onclick="setCategory('${cat}')">
        ${cat}
      </div>
    `;
  });
}

function setCategory(category){
  activeCategory = category;
  renderCategories();
  filterProducts();
}


// --- CART LOGIC (ÙƒÙ…Ø§ Ù‡Ùˆ) ---

function addToCart(id){
  // If in browse mode, force user back to landing page
  if (isBrowseMode) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ ÙˆÙ…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø·Ù„Ø¨.");
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¹Ø±Ø¶
    showPage('landing');
    // **Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯:** Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø­Ø§Ù„Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ 'landing' Ø¹Ù†Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    history.pushState({ page: 'landing' }, '', location.pathname); 
    return;
  }

  const p = allProducts[id];
  if(!p || p.outOfStock) return; 

  if(!cart[id]) cart[id] = {...p, qty:0};
  cart[id].qty++;
  renderCart();
}

function changeQty(id,amount){
  if(!cart[id]) return;
  cart[id].qty += amount;
  if(cart[id].qty<=0) delete cart[id];
  renderCart();
}

function renderCart(){
  const items = document.getElementById("cartItems");
  items.innerHTML = "";

  let subtotal = 0;

  if(Object.keys(cart).length === 0){
    items.innerHTML = `
      <div style="text-align:center;padding:40px 20px;color:var(--muted)">
        <div style="font-size:24px;margin-bottom:10px">ğŸ›’</div>
        <div style="font-size:16px">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>
        <div style="font-size:14px;margin-top:8px">Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
      </div>
    `;
  } else {
    Object.values(cart).forEach(it=>{
      subtotal += it.price * it.qty;
      items.innerHTML += `
        <div class="cart-item">
          <div style="flex:1">
            <strong>${it.name}</strong><br>
            <span style="font-size:14px;color:var(--muted)">${it.price}.00 Ø¯ÙŠÙ†Ø§Ø± Ã— ${it.qty}</span>
          </div>
          <div>
            <button class="qty-btn" onclick="changeQty('${it.id}',1)">+</button>
            <span style="padding:0 8px;font-weight:bold">${it.qty}</span>
            <button class="qty-btn" onclick="changeQty('${it.id}',-1)">-</button>
          </div>
        </div>
      `;
    });
  }

  document.getElementById("subtotal").textContent = subtotal.toFixed(2) + " Ø¯ÙŠÙ†Ø§Ø±";
  updateTotal();

  const count = Object.values(cart).reduce((s,i)=>s+i.qty,0);
  document.getElementById("cartBtn").textContent = `Ø§Ù„Ø³Ù„Ø© (${count})`;
}

/* CART SHEET TOGGLE */
document.getElementById("cartBtn").onclick = ()=>{
  document.getElementById("cartSheet").classList.add("open");
};

document.getElementById("closeCartSheet").onclick = ()=>{
  document.getElementById("cartSheet").classList.remove("open");
};

document.getElementById("cartSheet").addEventListener('click', function(e) {
  if(e.target.id === 'cartSheet') {
    this.classList.remove('open');
  }
});

/* ORDER TYPE + DELIVERY */
document.getElementById("orderType").onchange = updateTotal;
document.getElementById("paymentType").onchange = updateTotal; 

/* FINAL TOTAL */
function updateTotal(){
  let subtotal = 0;
  Object.values(cart).forEach(i=> subtotal += i.price * i.qty);
  
  function getDeliveryPrice(areaName) {
      const area = Object.values(allAreas).find(a => a.name === areaName);
      return area ? area.price : 0;
  }

  const type = document.getElementById("orderType").value;
  const area = document.getElementById("headerAreaSelect").value; 
  let delivery = 0;

  if(type==="delivery" && area){
    delivery = getDeliveryPrice(area) || 0;
    document.getElementById("deliveryPriceBox").style.display = 'flex';
    document.getElementById("deliveryPrice").textContent = delivery.toFixed(2) + " Ø¯ÙŠÙ†Ø§Ø±";
  } else {
    document.getElementById("deliveryPriceBox").style.display = 'none';
  }

  document.getElementById("subtotal").textContent = subtotal.toFixed(2) + " Ø¯ÙŠÙ†Ø§Ø±";
  
  document.getElementById("finalTotal").textContent =
    (subtotal + delivery).toFixed(2) + " Ø¯ÙŠÙ†Ø§Ø±";
}


/* SUCCESS MESSAGE FUNCTIONS */
function showSuccessMessage() {
  document.getElementById("successMessage").style.display = "flex";
}

function closeSuccessMessage() {
  document.getElementById("successMessage").style.display = "none";
}

/* PLACE ORDER - Send to Firebase */
document.getElementById("placeOrder").onclick = ()=>{
  if(Object.keys(cart).length===0){
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
    return;
  }
  
  const orderNotes = document.getElementById("orderNotes").value.trim();
  const orderType = document.getElementById("orderType").value;
  const paymentType = document.getElementById("paymentType").value; 
  
  const area = document.getElementById("headerAreaSelect").value;
  
  if(orderType === "delivery" && !area) {
     alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© (Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©) Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„.");
     document.getElementById("headerAreaSelect").focus();
     return;
  }
  
  let subtotal = 0;
  const cartItems = Object.values(cart).map(i => {
    subtotal += i.price * i.qty;
    return {
        id: i.id,
        name: i.name,
        price: i.price,
        qty: i.qty,
        total: i.price * i.qty
    };
  });
  
  function getDeliveryPrice(areaName) {
      const area = Object.values(allAreas).find(a => a.name === areaName);
      return area ? area.price : 0;
  }

  let delivery = 0;
  if(orderType === "delivery" && area) {
    delivery = getDeliveryPrice(area) || 0;
  }
  const finalTotal = subtotal + delivery;
  
  // Prepare the order object for Firebase
  const orderData = {
    customerPhone: userPhone,
    customerArea: area || "Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…",
    method: orderType, // delivery or take
    payment: paymentType, // cash or mobi
    total: finalTotal,
    subtotal: subtotal,
    deliveryFee: delivery,
    notes: orderNotes || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª",
    items: cartItems,
    createdAt: Date.now(),
    status: 'received' 
  };
  
  // Send to Firebase
  db.ref('orders').push(orderData)
    .then(() => {
        showSuccessMessage();
        
        // Reset cart and form
        cart = {};
        renderCart();
        document.getElementById("orderNotes").value = "";
        document.getElementById("orderType").value = "delivery"; 
        document.getElementById("paymentType").value = "cash"; 
        document.getElementById("cartSheet").classList.remove("open");
    })
    .catch(error => {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: " + error.message);
    });
};
</script>
</body>
</html>